<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Michael Kearney" />

<meta name="date" content="2015-11-09" />

<title>Tutorial for the NicheMapR microclimate model</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Tutorial for the NicheMapR microclimate model</h1>
<h4 class="author"><em>Michael Kearney</em></h4>
<h4 class="date"><em>2015-11-09</em></h4>
</div>


<p>This vignette provides a detailed tutorial of the Niche Mapper microclimate model as implemented in the package <em>NicheMapR</em>. See the <em>microclimate</em> vignette for details on the underlying theory and equations.</p>
<div id="getting-started-working-with-the-micro_global-function" class="section level2">
<h2>Getting started: working with the micro_global() function</h2>
<p>The <em>NicheMapR</em> package includes data and functions for using a global monthly climate database for computing microclimates. This tutorial starts by illustrating the different capabilities of the microclimate model using this database. For details on setting the model up to run with your own environmental data, see (refer to section below).</p>
<div id="basic-operation-modelling-microclimates-for-the-average-day-of-each-month" class="section level3">
<h3>Basic operation: modelling microclimates for the average day of each month</h3>
<p>This first example involves the most basic case of running the model to produce 12 days of output, one for each month of the year, without involking the soil moisture or snow subroutines. In this mode of operation, the model does three iterations of each day, the first one starting with a uniform soil temperature profile and the first two acting as ‘burn-in’ runs prior to the third and final run which is provided as the final output.</p>
<p>Try running the model for a place of interest to you, as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(NicheMapR)

micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc=</span><span class="st">&quot;Madison, Wisconsin, USA&quot;</span>)</code></pre>
<p>The results are stored as a list in the variable <em>micro</em>. The main ones to focus on for now are</p>
<ul>
<li><strong>metout</strong> The above ground micrometeorological conditions under the minimum specified shade</li>
<li><strong>shadmet</strong> The above ground micrometeorological conditions under the maximum specified shade</li>
<li><strong>soil</strong> Hourly predictions of the soil temperatures under the minimum specified shade</li>
<li><strong>shadsoil</strong> Hourly predictions of the soil temperatures under the maximum specified shade</li>
</ul>
<p>The first two rows of the output tables <strong>metout</strong> and <strong>shadmet</strong> look like this</p>
<p>and show, for each day of the year and for each hour of the day, a series of aboveground microclimatic conditions as follows:</p>
<ol style="list-style-type: decimal">
<li>JULDAY - day of year</li>
<li>TIME - time of day (mins)</li>
<li>TALOC - air temperature (deg C) at local height (specified by ‘Usrhyt’ variable)</li>
<li>TAREF - air temperature (deg C) at reference height (1.2m)</li>
<li>RHLOC - relative humidity (%) at local height (specified by ‘Usrhyt’ variable)</li>
<li>RH - relative humidity (%) at reference height (1.2m)</li>
<li>VLOC - wind speed (m/s) at local height (specified by ‘Usrhyt’ variable)</li>
<li>VREF - wind speed (m/s) at reference height (1.2m)</li>
<li>SNOWMELT - snowmelt (mm)</li>
<li>POOLDEP - water pooling on surface (mm)</li>
<li>PCTWET - soil surface wetness (%)</li>
<li>ZEN - zenith angle of sun (degrees - 90 = below the horizon)</li>
<li>SOLR - solar radiation (W/m2)</li>
<li>TSKYC - sky radiant temperature (deg C)</li>
<li>DEW - dew presence (0 or 1)</li>
<li>FROST - frost presence (0 or 1)</li>
<li>SNOWFALL - snow predicted to have fallen (mm)</li>
<li>SNOWDEP - predicted snow depth (cm)</li>
</ol>
<p>Note that for air temperature, relative humidity and wind speed, there’s a ‘reference height’ value and a ‘local height’ value. The reference height value is the height at which the meteorological observations were made that were given to the model as input. The local height values are the microclimatic values at a height determined by the variable <em>Usrhyt</em>, which you can set to be relevant to the organism you are interested in (by default it is 1cm). It should be at the midpoint of the animal or plant’s height.</p>
<p>Check what you got with:</p>
<pre><code>metout&lt;-micro$metout # put the metout result into a variable 'metout'
head(metout,24) # show the first 24 rows, i.e. the first day

shadmet&lt;-micro$shadmet # put the shadmet result into a variable 'shadmet'
head(shadmet,24) # show the first 24 rows, i.e. the first day</code></pre>
<p>Because the snow model wasn’t flagged to run, there will be zeros in all the snow-related columns.</p>
<p>The first two rows of the output tables <strong>soil</strong> and <strong>shadsoil</strong> look like this</p>
<p>and show, for each day of the year and for each hour of the day, the soil temperatures as follows:</p>
<ol style="list-style-type: decimal">
<li>JULDAY - day of year</li>
<li>TIME - time of day (mins)</li>
<li>Columns 3-12 D0cm … - soil temperatures at each of the 10 specified depths</li>
</ol>
<p>Have a look at yours:</p>
<pre><code>soil&lt;-micro$soil # put the soil result into a variable 'soil'
head(soil,24) # show the first 24 rows, i.e. the first day

shadsoil&lt;-micro$shadsoil # put the metout result into a variable 'shadsoil'
head(shadsoil,24) # show the first 24 rows, i.e. the first day</code></pre>
<p>The 10 different depths used by the model are specified with <em>DEP</em> and by default are <code>DEP=c(0., 2.5,  5.,  10.,  15.,  20.,  30.,  50.,  100.,  200.)</code>.</p>
<p>There are some example plots of all the variables in the help for the <em>micro_global</em> function. Here is a plot for all the soil temperatures in Madison, Wisconsin in July and December:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(lattice,<span class="dt">quietly =</span> <span class="ot">TRUE</span>)
soil&lt;-<span class="kw">as.data.frame</span>(micro$soil) <span class="co"># get the soil data</span>
minshade&lt;-micro$minshade <span class="co"># get the value for minimum shade</span>
<span class="kw">with</span>(<span class="kw">subset</span>(soil,JULDAY==<span class="dv">196</span> |<span class="st"> </span>JULDAY==<span class="dv">349</span>),{<span class="kw">xyplot</span>(D0cm +<span class="st"> </span>D2.5cm +<span class="st"> </span>D5cm +<span class="st"> </span>D10cm +<span class="st"> </span>D15cm +<span class="st"> </span>D20cm
  +<span class="st"> </span>D30cm +<span class="st"> </span>D50cm +<span class="st"> </span>D100cm +<span class="st"> </span>D200cm ~<span class="st"> </span>TIME |<span class="st"> </span><span class="kw">as.factor</span>(JULDAY),<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">xlab =</span> <span class="st">&quot;Time of Day</span>
<span class="st">  (min)&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Soil Temperature (deg C)&quot;</span>, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">5</span>), <span class="dt">as.table =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span>
    <span class="st">&quot;b&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(minshade,<span class="st">&quot;% shade&quot;</span>))})</code></pre>
<p>Notice how the deeper one goes into the soil, the lower the amplitude of the fluctuations but also that the maximum temperature is reached later in the day. The daily fluctuations have largely disappeared by 50cm and at 200cm the temperature is stable year round. In fact the model assumes the deep soil temperature is the annual mean of the air temperatures, and this is a ‘boundary condition’ in the solution of the soil heat budget.</p>
</div>
<div id="simulating-shading-by-vegetation" class="section level3">
<h3>Simulating shading by vegetation</h3>
<p>By default the model runs twice, for two different levels of shading by vegetation. The particular shade levels can be selected with the parameters <em>maxshade</em> and <em>minshade</em>. Also, the second shade level simulation can be turned off if only one shade level is required with the parameter <em>runshade</em>. The code below runs the model for one shade level only, 50%:</p>
<pre class="sourceCode r"><code class="sourceCode r">micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc =</span> <span class="st">&quot;Madison, Wisconsin, USA&quot;</span>, <span class="dt">runshade =</span> <span class="dv">0</span>, <span class="dt">minshade =</span> <span class="dv">50</span>)

soil&lt;-<span class="kw">as.data.frame</span>(micro$soil) <span class="co"># get the soil data</span>
minshade&lt;-micro$minshade <span class="co"># get the value for minimum shade</span>
<span class="kw">with</span>(<span class="kw">subset</span>(soil,JULDAY==<span class="dv">196</span> |<span class="st"> </span>JULDAY==<span class="dv">349</span>),{<span class="kw">xyplot</span>(D0cm +<span class="st"> </span>D2.5cm +<span class="st"> </span>D5cm +<span class="st"> </span>D10cm +<span class="st"> </span>D15cm +<span class="st"> </span>D20cm
  +<span class="st"> </span>D30cm +<span class="st"> </span>D50cm +<span class="st"> </span>D100cm +<span class="st"> </span>D200cm ~<span class="st"> </span>TIME |<span class="st"> </span><span class="kw">as.factor</span>(JULDAY),<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">xlab =</span> <span class="st">&quot;Time of Day</span>
<span class="st">  (min)&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Soil Temperature (deg C)&quot;</span>, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">5</span>), <span class="dt">as.table =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span>
    <span class="st">&quot;b&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(minshade,<span class="st">&quot;% shade&quot;</span>))})</code></pre>
<p>Notice how, the effect of shade is to not only reduce the daytime soil temperatures, but also to increase the nighttime temperatures. This is due to the increased levels of infrared radiation reaching the ground surface because the shading vegetation is assumed to be at the reference height air temperature while the ‘sky temperature’ is typically much colder, depending on the level of cloud cover (have a look at the variable <em>Tsky</em> in the <strong>metout</strong> and <strong>shadmet</strong> outputs).</p>
</div>
<div id="simulating-terrain-effects---slope-aspect-hillshade" class="section level3">
<h3>Simulating terrain effects - slope, aspect, hillshade</h3>
<p>Slope and aspect have strong effects on microclimates through the effects of direct solar radiation. The default setting is flat ground in the <em>NicheMapR</em> microclimate model. Here is the effect of a 45 degree southerly slope on the 0% shade simulation:</p>
<pre class="sourceCode r"><code class="sourceCode r">micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc =</span> <span class="st">&quot;Madison, Wisconsin, USA&quot;</span>, <span class="dt">runshade =</span> <span class="dv">0</span>, <span class="dt">minshade =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">45</span>, aspect
  =<span class="st"> </span><span class="dv">180</span>)

soil&lt;-<span class="kw">as.data.frame</span>(micro$soil) <span class="co"># get the soil data</span>
minshade&lt;-micro$minshade <span class="co"># get the value for minimum shade</span>
<span class="kw">with</span>(<span class="kw">subset</span>(soil,JULDAY==<span class="dv">196</span> |<span class="st"> </span>JULDAY==<span class="dv">349</span>),{<span class="kw">xyplot</span>(D0cm +<span class="st"> </span>D2.5cm +<span class="st"> </span>D5cm +<span class="st"> </span>D10cm +<span class="st"> </span>D15cm +<span class="st"> </span>D20cm
  +<span class="st"> </span>D30cm +<span class="st"> </span>D50cm +<span class="st"> </span>D100cm +<span class="st"> </span>D200cm ~<span class="st"> </span>TIME |<span class="st"> </span><span class="kw">as.factor</span>(JULDAY),<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">xlab =</span> <span class="st">&quot;Time of Day</span>
<span class="st">  (min)&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Soil Temperature (deg C)&quot;</span>, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">5</span>), <span class="dt">as.table =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span>
    <span class="st">&quot;b&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(minshade,<span class="st">&quot;% shade, 45 degree slope, 180 degrees aspect&quot;</span>))})</code></pre>
<p>The strongest effect is on the December soil temperatures.</p>
<p>Hillshade also has a strong effect on microclimates. Gullies and gorges receive a shorter window of direct solar radiation and have a smaller ‘view’ of the sky, and so don’t cool down as much at night. Horizon angles can be specified to simulated these kinds of effects by supplying in the parameter <em>hori</em> a vector of 24 horizon angles (angle to nearest hill/cliff) starting due north and continuing clockwise in 15 degree intervals. Here is an example for a steep-sided gully running north-south:</p>
<pre class="sourceCode r"><code class="sourceCode r">micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc=</span><span class="st">&quot;Madison, Wisconsin, USA&quot;</span>, <span class="dt">runshade =</span> <span class="dv">0</span>, <span class="dt">minshade =</span> <span class="dv">0</span>, <span class="dt">hori =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">65</span>,
  <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>, <span class="dv">65</span>))

soil&lt;-<span class="kw">as.data.frame</span>(micro$soil) <span class="co"># get the soil data</span>
minshade&lt;-micro$minshade <span class="co"># get the value for minimum shade</span>
<span class="kw">with</span>(<span class="kw">subset</span>(soil,JULDAY==<span class="dv">196</span> |<span class="st"> </span>JULDAY==<span class="dv">349</span>),{<span class="kw">xyplot</span>(D0cm +<span class="st"> </span>D2.5cm +<span class="st"> </span>D5cm +<span class="st"> </span>D10cm +<span class="st"> </span>D15cm +<span class="st"> </span>D20cm
  +<span class="st"> </span>D30cm +<span class="st"> </span>D50cm +<span class="st"> </span>D100cm +<span class="st"> </span>D200cm ~<span class="st"> </span>TIME |<span class="st"> </span><span class="kw">as.factor</span>(JULDAY),<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">xlab =</span> <span class="st">&quot;Time of Day</span>
<span class="st">  (min)&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Soil Temperature (deg C)&quot;</span>, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">5</span>), <span class="dt">as.table =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span>
    <span class="st">&quot;b&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(minshade,<span class="st">&quot;% shade, north-south gully&quot;</span>))})</code></pre>
</div>
<div id="changing-the-soil-properties" class="section level3">
<h3>Changing the soil properties</h3>
<p>Another important influence on microclimatic conditions is the substrate type. The substrate solar reflectivity can be changed with the parameter <em>REFL</em> and the emissivity with the parameter <em>SLE</em> (both range from 0-1).</p>
<p>Soil thermal properties are also importance. Soil comprises a mixture of minerals, air and water. The density (kg/m3), thermal conductivity (W/mK) and specific heat capacity (J/kg-K) of the mineral component are specified by the parameters <em>Density</em>, <em>Thcond</em> and <em>SpecHeat</em>, respectively. The bulk density determines the proportion of the soil volume that is air, parameter <em>BulkDensity</em> (kg/m3).</p>
<p>The default values are typical for soil minerals as described in Campbell and Norman (1998) Table 8.2, but an ‘A-horizon’ layer for the first node, reflecting properties of organic matter, is also simulated (see Kearney et al. 2014). This can be turned off by specifying <code>cap = 0</code>.</p>
<p>For simulating rock, <em>BulkDensity</em> should be set the same as <em>Density</em> and this can be easily set in <em>micro_global</em> by setting <em>soiltype</em> to value 0 (which also sets cap = 0):</p>
<pre class="sourceCode r"><code class="sourceCode r">micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc=</span><span class="st">&quot;Madison, Wisconsin, USA&quot;</span>, <span class="dt">runshade =</span> <span class="dv">0</span>, <span class="dt">minshade =</span> <span class="dv">0</span>, <span class="dt">soiltype =</span> <span class="dv">0</span>)

soil&lt;-<span class="kw">as.data.frame</span>(micro$soil) <span class="co"># get the soil data</span>
minshade&lt;-micro$minshade <span class="co"># get the value for minimum shade</span>
<span class="kw">with</span>(<span class="kw">subset</span>(soil,JULDAY==<span class="dv">196</span> |<span class="st"> </span>JULDAY==<span class="dv">349</span>),{<span class="kw">xyplot</span>(D0cm +<span class="st"> </span>D2.5cm +<span class="st"> </span>D5cm +<span class="st"> </span>D10cm +<span class="st"> </span>D15cm +<span class="st"> </span>D20cm
  +<span class="st"> </span>D30cm +<span class="st"> </span>D50cm +<span class="st"> </span>D100cm +<span class="st"> </span>D200cm ~<span class="st"> </span>TIME |<span class="st"> </span><span class="kw">as.factor</span>(JULDAY),<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">xlab =</span> <span class="st">&quot;Time of Day</span>
<span class="st">  (min)&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Soil Temperature (deg C)&quot;</span>, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">5</span>), <span class="dt">as.table =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span>
    <span class="st">&quot;b&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(minshade,<span class="st">&quot;% shade, rock substrate&quot;</span>))})</code></pre>
<p>Notice how the heat penetrates more deeply into the rock, producing a gentler temperature gradient with depth, cooler near-surface temperatures during the day and warmer near-surface temperatures at night.</p>
<p>The texture of the soil, i.e. the proportion of silt, sand and clay and associated particle size distributions, has a powerful influence on soil moisture and is discussed further in the next section.</p>
</div>
<div id="soil-moisture" class="section level3">
<h3>Soil moisture</h3>
</div>
<div id="running-at-finer-time-intervals-and-for-longer-time-periods" class="section level3">
<h3>Running at finer time intervals and for longer time periods</h3>
<p>It is possible to run the model for more frequent intervals than once per month by changing the parameter <em>timeinterval</em>. If <em>timeinterval</em> is set to something less than 365, then the model runs as described in the previous section with three iterations per day, and uses the ‘spline’ function to interpolate the climate data from monthly to the chosen time interval. If ‘timeinterval’ is set to the maximum value of 365, it will apply the three iterations to the first day of the simulation to get started and then, from that day on, use the previous day’s conditions as the initial state for the next day’s conditions.</p>
<p>It is also possible to run the model for multiple years by changing the <em>nyears</em> parameter. This can be useful when running the soil moisture and snow subroutines (described below) to allow annual cycles to stabilise.</p>
</div>
<div id="snow" class="section level3">
<h3>Snow</h3>
</div>
</div>
<div id="more-examples" class="section level2">
<h2>More Examples</h2>
<p>You can write math expressions, e.g. <span class="math">\(Y = X\beta + \epsilon\)</span></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
