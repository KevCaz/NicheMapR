<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Michael Kearney" />

<meta name="date" content="2016-01-06" />

<title>Introduction to the NicheMapR ectotherm model</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0A%7D%0Apre%20%7B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to the NicheMapR ectotherm model</h1>
<h4 class="author"><em>Michael Kearney</em></h4>
<h4 class="date"><em>2016-01-06</em></h4>
</div>


<p>This vignette provides a detailed tutorial of the Niche Mapper ectotherm model as implemented in the package <em>NicheMapR</em>. It only considers the base heat and (partial) water budget model. For details on the implementation of the Dynamic Energy Budget model (for simulating growth, development and reproduction as well as full water budgets), see the <em>DEB-model-tutorial</em> vignette (on the to do list!).</p>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The <em>NicheMapR</em> ectotherm model is run with the function <em>ectotherm</em>. This includes computations of steady state and transient heat budgets for animals that do not produce signficant metabolic heat. It includes a range of morphological, physiological and behavioural options to capture how organisms exchange heat and water with their environments, and to compute the consequences of this for body temperature, activity constraints and different aspects of the mass budget. It is designed to take the output of the <em>NicheMapR</em> microclimate model as the driving environmental inputs, but the user can construct custom versions of these if desired (see section xxx).</p>
<div id="basic-operation-modelling-heat-and-activity-budgets-for-the-average-day-of-each-month" class="section level3">
<h3>Basic operation: modelling heat and activity budgets for the average day of each month</h3>
<p>As with the microclimate model tutorial, this first example involves the most basic case of running the model to produce 12 days of output, one for each month of the year. Try running the model with the default inputs for a location of your choice, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(NicheMapR)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc =</span> <span class="st">&quot;Kuranda, Queensland&quot;</span>)
ecto&lt;-<span class="kw">ectotherm</span>()</code></pre></div>
<p>The results are stored as a list in the variable <em>ecto</em>. The main ones to focus on for now are</p>
<ul>
<li><strong>environ</strong> The body temperature, activity and envionments experienced by the animal</li>
<li><strong>enbal</strong> The components of the computed heat budget</li>
<li><strong>masbal</strong> The components of the computed mass budget</li>
</ul>
<p>The output table <strong>environ</strong> look like this (first 15 columns):</p>
<p>and includes the following variables:</p>
<ol style="list-style-type: decimal">
<li>JULDAY - day of year</li>
<li>YEAR - year of simulation</li>
<li>DAY - day of simulation</li>
<li>TIME - time of day (hours)</li>
<li>TC - body temperature (°C)</li>
<li>SHADE - shade selected (%)</li>
<li>SOLAR - solar radiation (W/m2) at animal location</li>
<li>DEP - depth below ground (cm)</li>
<li>ACT - activity state (0=inactive, 1=basking, 2=foraging)</li>
<li>TA - air temperature (°C) at animal location</li>
<li>VEL - wind speed (m/s) at animal location</li>
<li>RELHUM - relative humidity (%) at animal location</li>
<li>ZEN - zenith angle of sun (degrees, where 90° = below the horizon)</li>
<li>CONDEP - depth of water body (cm) (may not be simulated or supplied)</li>
<li>WATERTEMP - temperature of water body (°C) (may not be simulated or supplied)</li>
<li>DAYLENGTH - day length (hours)</li>
<li>WINGANGLE - wing angle (degrees) for butterfly model</li>
<li>WINGTEMP - wing temperature (°C) for butterfly model</li>
<li>FLYING - flying state (1=flying, 0=not flying) for butterfly model</li>
<li>FLYTIME - flying time (hours) for butterfly model</li>
</ol>
<p>The model has considered, for each hour of the day, where the organism could be conditional on the behavioural options set. The default simulation is for the Eastern Water Skink, <em>Eulamprus quoyii</em>, which is diurnal (<em>dayact</em> = 1, <em>nocturn</em> = 0, <em>crepus</em> = 0). So, for the nighttime and twilight hours, the animal is assumed to be underground (<em>burrow</em> = 1). The algorithm choosing the depth to put the animal starts at the shallowest depth allowed and moves deeper only if it would go below the stated critical thermal minimum <em>ctmin</em> (6 °C by default) or if it would be half way between the maximum voluntary foraging temperature <em>VTMAX</em> (34 °C by default) and the critical thermal maximum <em>ctmax</em> (40 °C by default). Note how the wind speed is set to an arbitrarily low value when then animal is sheltering under ground, and the air, substrate and ‘sky’ temperatures are set to be equal to the soil temperature at the chosen depth.</p>
<p>When the sun rises (<em>ZEN</em> &lt; 90°, on the 7th hour in this case) the model tries placing the animal on the surface in the open, as long as the animal’s body temeprature is above the emergence temperature <em>TEMERGE</em> (17.5 °C by default). If the resulting computed body temperature is above the basking threshold <em>TBASK</em> (also 17.5 °C by default), that becomes the selected environment and the activity state <em>ACT</em> is set to 1. If the body temperature is above the minimum foraging temperature <em>VTMIN</em>, then activity state is set to 2. If the animal’s predicted temperature is above the preferred temperature <em>TPREF</em> (30 °C by default), then shade seeking is invoked if allowed (<em>CkGrShad</em> = 1), which is what has happened in this example. The shade jumps in 3% intervals, and 9% was sufficient in this case. As the day moves on, the animal in this example can remain active near its preferred body temperature but only by ramping up the shade, to the maximum level of 90% in this case (vector <em>maxshades</em>) which by default comes from the microclimate model settings). Once the maximum shade is reached, the animal’s preferred temperature is allowed to rise in 0.5 degree increments until the maximum foraging temperature is reached <em>VTMAX</em>, upon which the animal is forced to become inactive.</p>
<p>The output table <strong>enbal</strong> looks like this:</p>
<p>It quantifies the different pathways of exchange in each hour of the simulation:</p>
<ol style="list-style-type: decimal">
<li>JULDAY - day of year</li>
<li>YEAR - year of simulation</li>
<li>DAY - day of simulation</li>
<li>TIME - time of day (hours)</li>
<li>TC - body temperature (°C)</li>
<li>QSOL - solar radiation absorbed (W)</li>
<li>QIRIN - infrared radiation absorbed (W)</li>
<li>QMET - metabolic heat production (W)</li>
<li>QEVAP - evaporative heat loss (W)</li>
<li>QIROUT - infrared radiation lost (W)</li>
<li>QCONV - heat lost by convection (W)</li>
<li>QCOND - heat lost by conduction (W)</li>
<li>ENB - energy balance (°C)</li>
<li>NTRY - iterations required for solution to heat balance equation</li>
</ol>
<p>where the complete heat budget is</p>
<p><span class="math inline">\(ENB = QSOL + QIRIN + QMET - QEVAP - QIROUT - QCONV - QCOND\)</span></p>
<p>QIRIN, QIROUT, QSOL and QMET will always be positive, but QEVAP, QCONV and QCOND may be positive or negative. E.g. in this case, QCOND is positive when the animal is in its retreat (so resulting in a loss of heat in the heat budget equation above) because the ground is slightly cooler than the animal, but negative from 9am when the ground has become warmer than the animal. Notice how QMET and QEVAP are very similar - they change in concert (higher metabolic rate means more respiratory water loss), mostly cancelling each other out, and so can often be neglected in heat budgets of small ectotherms. Notice also that more iterations of the model NTRY are required when the animal is out of its burrow, due to the model repeatedly trying different options (e.g. increasing shade, increasing the target temperature, etc.) until it finds a solution.</p>
<p>Finally, the output table <strong>masbal</strong> looks like this:</p>
<ol style="list-style-type: decimal">
<li>JULDAY - day of year</li>
<li>YEAR - year of simulation</li>
<li>DAY - day of simulation</li>
<li>TIME - time of day (hours)</li>
<li>O2_ml - oxygen consumption rate (ml/h)</li>
<li>CO2_ml - carbon dioxide production rate (ml/h)</li>
<li>NWASTE_g - nitrogenous waste production (g/h)</li>
<li>H2OFree_g - water from food (g/h)</li>
<li>H2OMet_g - metabolic water production (g/h)</li>
<li>DryFood_g - dry food intake (g/h)</li>
<li>WetFood_g - wet foood intake (g/h)</li>
<li>DryFaeces_g - dry faeces production (g/h)</li>
<li>WetFaeces_G - wet faeces production (g/h)</li>
<li>Urine_g - urine production (g/h)</li>
<li>H2OResp_g - respiratory water loss (g/h)</li>
<li>H2OCut_g - cutaneous water loss (g/h)</li>
<li>H2OEye_g - ocular water loss (g/h)</li>
<li>H2OBal_g - instantaneous water balance (g/h)</li>
<li>H2OCumBal_g - cumulative water balance (g)</li>
</ol>
<p>Most of these columns are zero because we are not running the on-board mass budget model (the Dynamic Energy Budget model, i.e. <em>DEB</em> = 0 by default). We are instead obtaining the oxygen consumption rate (ml/h) by an allometric function based on Eq. 2 from Andrews &amp; Pough 1985,</p>
<p><span class="math inline">\(V_{O_2} = M_1 M^{ M_2} 10^{M_3 T_b}\)</span></p>
<p>where <span class="math inline">\(M\)</span> is the mass in grams, <span class="math inline">\(T_b\)</span> is the body temperature, and <span class="math inline">\(M_1\)</span>, <span class="math inline">\(M_2\)</span> and <span class="math inline">\(M_3\)</span> are constants which can be user-defined. From this and the oxygen extraction efficiency <em>extref</em> and difference in temperature between expired and inspired air <em>DETLAIR</em> (0.1 °C by default), the respiratory water loss <em>H2OResp_g</em> can be computed. From the percentage of the skin that is ‘wet’ <em>skinwet</em> one can estimate the cutaneous water loss <em>H2O_cut</em>. The <em>skinwet</em> parameter represents the % surface area that would act as free water surface if all the little pores letting water through the skin were collected together in one place. Finally, the parameter <em>aeyes</em> is the % of the total surface area taken up by the eyes when open, and is used to compute ocular water loss when the animal is active (a substantial part of the water loss!). If you are interested in the other quantities available in the <strong>masbal</strong> output, you will need to develop a DEB model for your species (see the <a href="http://www.bio.vu.nl/thb/deb/deblab/">Dynamic Energy Budget lab</a>, particularly the <a href="http://www.bio.vu.nl/thb/deb/deblab/add_my_pet/">Add-my-pet Portal</a>, for details, as well as the vignette (to do!) which explains the <strong>debout</strong> ouptut table).</p>
</div>
</div>
<div id="plotting-some-output" class="section level2">
<h2>Plotting some output</h2>
<p>Now let’s take a more detailed look at the results, by running the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># retrieve output</span>
metout&lt;-<span class="kw">as.data.frame</span>(micro$metout) <span class="co"># above ground microclimatic conditions, min shade</span>
environ&lt;-<span class="kw">as.data.frame</span>(ecto$environ) <span class="co"># activity, Tb and environment</span>
enbal&lt;-<span class="kw">as.data.frame</span>(ecto$enbal) <span class="co"># energy balance values</span>
masbal&lt;-<span class="kw">as.data.frame</span>(ecto$masbal) <span class="co"># mass balance value (note most missing if DEB </span>
<span class="co">#model not running)</span>

<span class="co"># append dates</span>
days&lt;-<span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>),<span class="dv">24</span>)
days&lt;-days[<span class="kw">order</span>(days)]
dates&lt;-days+metout$TIME/<span class="dv">60</span>/<span class="dv">24-1</span> <span class="co"># dates for hourly output</span>
dates2&lt;-<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">1</span>) <span class="co"># dates for daily output</span>
metout&lt;-<span class="kw">cbind</span>(dates,metout)
environ&lt;-<span class="kw">cbind</span>(dates,environ)
masbal&lt;-<span class="kw">cbind</span>(dates,masbal)
enbal&lt;-<span class="kw">cbind</span>(dates,enbal)

<span class="co"># Hourly Tb (black), activity (orange, 5=bask, 10=forage), depth (brown, m) and shade </span>
<span class="co"># (green, %/10)</span>
<span class="kw">with</span>(environ, <span class="kw">plot</span>(TC~dates,<span class="dt">ylab=</span><span class="st">&quot;Tb, depth, activity and shade&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;month of year&quot;</span>,
<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">main =</span> 
    <span class="st">&quot;Fig. 1, Hourly Tb, depth, activity level and shade, 90% max shade&quot;</span>))
<span class="kw">with</span>(environ, <span class="kw">points</span>(ACT*<span class="dv">5</span>~dates,<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;orange&quot;</span>))
<span class="kw">with</span>(environ, <span class="kw">points</span>(SHADE/<span class="dv">10</span>~dates,<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>))
<span class="kw">with</span>(environ, <span class="kw">points</span>(DEP/<span class="dv">10</span>~dates,<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;brown&quot;</span>))
<span class="kw">abline</span>(ecto$VTMAX,<span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'red'</span>)
<span class="kw">abline</span>(ecto$VTMIN,<span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'blue'</span>)

<span class="co"># seasonal activity plot (dark blue = night, light blue = basking, orange = foraging)</span>
forage&lt;-<span class="kw">subset</span>(environ,ACT==<span class="dv">2</span>)
bask&lt;-<span class="kw">subset</span>(environ,ACT==<span class="dv">1</span>)
night&lt;-<span class="kw">subset</span>(metout,ZEN==<span class="dv">90</span>)
day&lt;-<span class="kw">subset</span>(metout,ZEN!=<span class="dv">90</span>)
<span class="kw">with</span>(night,<span class="kw">plot</span>(TIME/<span class="dv">60</span>~JULDAY,<span class="dt">ylab=</span><span class="st">&quot;Hour of Day&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;Day of Year&quot;</span>,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span><span class="dv">2</span>,<span class="dt">col=</span>
    <span class="st">'dark blue'</span>, <span class="dt">main =</span> <span class="st">&quot;Fig. 2 Annual activity window, 90% max shade&quot;</span>))
<span class="co"># nighttime hours</span>
<span class="kw">with</span>(forage,<span class="kw">points</span>((TIME<span class="dv">-1</span>)~JULDAY,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'orange'</span>)) <span class="co"># foraging Tbs</span>
<span class="kw">with</span>(bask,<span class="kw">points</span>((TIME<span class="dv">-1</span>)~JULDAY,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'light blue'</span>)) <span class="co"># basking Tbs</span></code></pre></div>
<p>In Fig. 1 you can see the daily cycles, for each month, of the body temperature (black), % shade selected (green, divided by 10 for plotting), activity level in orange (multiplied by 5 for plotting, so 5 = basking, 10 = active) and depth in brown (m). Also superimposed are the voluntary foraging thresholds <em>VTMIN</em> (blue dashed line) and <em>VTMAX</em> (red dashed line). Note how this lizard is active every day, but requires shade for this, and how body temperature jumps up on some evenings when it goes into its burrow (remember when inactive the body temperature may rise to a maximum of half way between <em>VTMAX</em> and <em>CTMAX</em> before the animal moves deeper into the burrow).</p>
<p>In Fig. 2 you can see the annual activity window, with dark blue representing the nighttime hours, light blue the foraging hours and orange the activity hours. Activity is possible for this lizard at this tropical location throughout all daylight hours except 6am in July, when it is only warm enough to bask.</p>
<p>Explore what changing the thermal thresholds <em>CTMIN</em>, <em>TEMERGE</em>, <em>TBASK</em>, <em>VTMIN</em>, <em>VTMAX</em> and <em>CTMAX</em> does to these plots, as well as variation in available shade <em>maxshades</em> and burrow depths <em>mindepth</em> and <em>maxdepth</em>. Here is an example of the effect of reducing maximum shade in all months from 90% to 50%:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ecto&lt;-<span class="kw">ectotherm</span>(<span class="dt">maxshades =</span> <span class="kw">rep</span>(<span class="dv">50</span>,<span class="dv">12</span>))</code></pre></div>
</div>
<div id="preview-of-the-dynamic-energy-budget-model-in-action" class="section level2">
<h2>Preview of the Dynamic Energy Budget model in action</h2>
<p>The capacity to compute body temperature, metabolic rates, activity times and some aspects of the water budget allow many important inferences to be made about the ability of different types of animals to live in different climates and habitats. In some cases such processes may be limiting factors in the distribution. For example, Kearney and Porter (2004) found that activity time was likely to be a limiting factor for a nocturnal lizard in southern Australia. More often, these constraints act to limit the overall energy and water budget in a more subtle manner.</p>
<p>The preliminary computations made in this tutorial can provide the starting point for an energy budget analysis that could ultimately allow you to predict reproductive success and survival rates, key vital rates from which to infer distribution and abundance. One of the most powerful ways of achieving a full mass balance and life cycle trajectory is by using the Dynamic Energy Budget model (Kooijman, 2010), the ‘standard model’ of which is optionally implemented in the <strong>ectotherm</strong> model.</p>
<p>Below is an example for the Eastern Water Skink (default settings for the DEB model), as developed in Schwarzkopf et al. (in press). Note the intersting pattern of annual foraging - under the DEB mode the animal only forages when it is stomach is below a certain percentage full, 75% by default). The sudden drops in mass in the plot of wet mass through time are when the animal reproduces. If you run this yourself, check the output of <strong>masbal</strong>, which will have values for all variables, and also the <strong>debout</strong>, <strong>yearout</strong> and <strong>yearsout</strong> outputs described in the help section for the <strong>ectotherm</strong> function. See vignette … for more details on how to work with the DEB model in NicheMapR.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># run the microclimate model daily for 5 years</span>
timeinterval&lt;-<span class="dv">365</span>
nyears&lt;-<span class="dv">5</span>
micro&lt;-<span class="kw">micro_global</span>(<span class="dt">loc =</span> <span class="st">&quot;Kuranda, Queensland&quot;</span>, <span class="dt">timeinterval =</span> timeinterval, <span class="dt">nyears =</span> nyears,
  <span class="dt">runmoist =</span> <span class="dv">1</span>)

<span class="co"># run the ectotherm model with the DEB model turned on and in viviparous mode, simulating the</span>
<span class="co"># Eastern Water Skink, Eulamprus quoyii</span>
ecto&lt;-<span class="kw">ectotherm</span>(<span class="dt">DEB =</span> <span class="dv">1</span>, <span class="dt">mindepth =</span> <span class="dv">4</span>, <span class="dt">viviparous =</span> <span class="dv">1</span>)

metout&lt;-<span class="kw">as.data.frame</span>(micro$metout) <span class="co"># above ground microclimatic conditions, min shade</span>
environ&lt;-<span class="kw">as.data.frame</span>(ecto$environ) <span class="co"># activity, Tb and environment</span>
masbal&lt;-<span class="kw">as.data.frame</span>(ecto$masbal) <span class="co"># activity, Tb and environment</span>
debout&lt;-<span class="kw">as.data.frame</span>(ecto$debout) <span class="co"># activity, Tb and environment</span>

<span class="co"># append dates</span>
days&lt;-<span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">1</span>,timeinterval*nyears),<span class="dv">24</span>)
days&lt;-days[<span class="kw">order</span>(days)]
dates&lt;-(days+metout$TIME/<span class="dv">60</span>/<span class="dv">24-1</span>)/<span class="dv">365</span> <span class="co"># dates for hourly output</span>
metout&lt;-<span class="kw">cbind</span>(dates,metout)
environ&lt;-<span class="kw">cbind</span>(dates,environ)
masbal&lt;-<span class="kw">cbind</span>(dates,masbal)
debout&lt;-<span class="kw">cbind</span>(dates,debout)

<span class="co"># Hourly Tb (black), activity (orange, 5=bask, 10=forage), depth (brown, m) and shade </span>
<span class="co"># (green, %/10)</span>
<span class="kw">with</span>(environ, <span class="kw">plot</span>(TC~dates,<span class="dt">ylab=</span><span class="st">&quot;Tb, depth, activity and shade&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;year&quot;</span>,
<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">20</span>,<span class="dv">70</span>),<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Hourly Tb, depth, activity level and shade&quot;</span>))
<span class="kw">with</span>(environ, <span class="kw">points</span>(ACT*<span class="dv">5</span>~dates,<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;orange&quot;</span>))
<span class="kw">with</span>(environ, <span class="kw">points</span>(SHADE/<span class="dv">10</span>~dates,<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>))
<span class="kw">with</span>(environ, <span class="kw">points</span>(DEP/<span class="dv">10</span>~dates,<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;brown&quot;</span>))
<span class="kw">abline</span>(ecto$VTMAX,<span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'red'</span>)
<span class="kw">abline</span>(ecto$VTMIN,<span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'blue'</span>)

<span class="co"># seasonal activity plot (dark blue = night, light blue = basking, orange = foraging)</span>
forage&lt;-<span class="kw">subset</span>(environ,ACT==<span class="dv">2</span>)
bask&lt;-<span class="kw">subset</span>(environ,ACT==<span class="dv">1</span>)
night&lt;-<span class="kw">subset</span>(<span class="kw">cbind</span>(metout,debout$DAY),ZEN==<span class="dv">90</span>)
day&lt;-<span class="kw">subset</span>(<span class="kw">cbind</span>(metout,debout$DAY),ZEN!=<span class="dv">90</span>)
<span class="kw">colnames</span>(night)[<span class="dv">20</span>]&lt;-<span class="st">&quot;DAY&quot;</span>
<span class="kw">colnames</span>(day)[<span class="dv">20</span>]&lt;-<span class="st">&quot;DAY&quot;</span>
<span class="kw">with</span>(night,<span class="kw">plot</span>(TIME/<span class="dv">60</span>~DAY,<span class="dt">ylab=</span><span class="st">&quot;Hour of Day&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;Day of Year&quot;</span>,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'dark blue'</span>,
  <span class="dt">main =</span> <span class="st">&quot;Annual activity windows&quot;</span>))
<span class="kw">with</span>(bask,<span class="kw">points</span>((TIME<span class="dv">-1</span>)~DAY,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'light blue'</span>)) <span class="co"># basking Tbs</span>
<span class="kw">with</span>(forage,<span class="kw">points</span>((TIME<span class="dv">-1</span>)~DAY,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">cex=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">'orange'</span>)) <span class="co"># foraging Tbs</span>

<span class="kw">with</span>(debout, <span class="kw">plot</span>(WETMASS~dates,<span class="dt">ylab=</span><span class="st">&quot;wet mass, g&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;year&quot;</span>,
<span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;wet mass through time&quot;</span>))</code></pre></div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Andrews, R. M., and H. F. Pough. 1985. Metabolism of squamate reptiles: allometric and ecological relationships. Physiological Zoology 58:214-231.</p>
<p>Kearney, M., and W. P. Porter. 2004. Mapping the fundamental niche: physiology, climate, and the distribution of a nocturnal lizard. Ecology 85:3119-3131.</p>
<p>Kooijman, S. A. L. M. 2010. Dynamic Energy Budget Theory for Metabolic Organisation. Cambridge University Press, Great Britain.</p>
<p>Schwarzkopf, L., M. J. Caley, and M. R. Kearney. in press. One lump or two? Explaining a major latitudinal transition in reproductive allocation in a viviparous lizard. Functional Ecology.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
